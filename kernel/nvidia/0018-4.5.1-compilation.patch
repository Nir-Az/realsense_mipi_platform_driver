From b61254353ca14a7e3b5b20137d8e44d03e0cc9b3 Mon Sep 17 00:00:00 2001
From: Emil Jahshan <emil.jahshan@intel.com>
Date: Wed, 13 Oct 2021 16:03:13 +0300
Subject: [PATCH] 4.5.1 compilation

 - fixed 4.5.1 relates compilation issues

Signed-off-by: Emil Jahshan <emil.jahshan@intel.com>
---
 drivers/media/platform/tegra/camera/vi/channel.c  | 5 ++---
 drivers/media/platform/tegra/camera/vi/graph.c    | 4 ++--
 drivers/media/platform/tegra/camera/vi/vi4_fops.c | 2 +-
 3 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/drivers/media/platform/tegra/camera/vi/channel.c b/drivers/media/platform/tegra/camera/vi/channel.c
index 7602cb8ab..d874bb200 100644
--- a/drivers/media/platform/tegra/camera/vi/channel.c
+++ b/drivers/media/platform/tegra/camera/vi/channel.c
@@ -1586,7 +1586,6 @@ static int tegra_channel_connect_sensor(
 	struct device_node *sensor_of_node;
 	struct tegra_csi_device *csi_device;
 	struct device_node *ep_node;
-	bool found = false;
 
 	if (!chan)
 		return -EINVAL;
@@ -2088,7 +2087,7 @@ __tegra_channel_get_parm(struct tegra_channel *chan,
 static int tegra_channel_get_parm (struct file *file, void *fh, struct v4l2_streamparm *a)
 {
        struct v4l2_fh *vfh = file->private_data;
-       struct tegra_channel *chan = to_tegra_channel(vfh->vdev);
+       struct tegra_channel *chan = video_get_drvdata(vfh->vdev);
 
        a->parm.capture.timeperframe.numerator = 1;
        a->parm.capture.timeperframe.denominator = 12;
@@ -2117,7 +2116,7 @@ __tegra_channel_set_parm(struct tegra_channel *chan,
 static int tegra_channel_set_parm(struct file *file, void *fh, struct v4l2_streamparm *a)
 {
        struct v4l2_fh *vfh = file->private_data;
-       struct tegra_channel *chan = to_tegra_channel(vfh->vdev);
+       struct tegra_channel *chan = video_get_drvdata(vfh->vdev);
 
        if (vb2_is_busy(&chan->queue))
                return -EBUSY;
diff --git a/drivers/media/platform/tegra/camera/vi/graph.c b/drivers/media/platform/tegra/camera/vi/graph.c
index 21cc9c758..5ddcf73ad 100644
--- a/drivers/media/platform/tegra/camera/vi/graph.c
+++ b/drivers/media/platform/tegra/camera/vi/graph.c
@@ -392,9 +392,9 @@ static int tegra_vi_graph_notify_complete(struct v4l2_async_notifier *notifier)
 	emb_ret = video_register_device(&chan->embedded.video,
 			VFL_TYPE_GRABBER, -1);
 	if (emb_ret < 0)
-		dev_err(&chan->video.dev, "%s(): register embedded %s: %d\n",
+		dev_err(&chan->video->dev, "%s(): register embedded %s: %d\n",
 			__func__, chan->embedded.video.name, emb_ret);
-	dev_err(&chan->video.dev, "%s(): register embedded %s: %d\n",
+	dev_err(&chan->video->dev, "%s(): register embedded %s: %d\n",
 				__func__, chan->embedded.video.name, emb_ret);
 
 	/* Create links for every entity. */
diff --git a/drivers/media/platform/tegra/camera/vi/vi4_fops.c b/drivers/media/platform/tegra/camera/vi/vi4_fops.c
index 4a8c43560..408f95fdc 100644
--- a/drivers/media/platform/tegra/camera/vi/vi4_fops.c
+++ b/drivers/media/platform/tegra/camera/vi/vi4_fops.c
@@ -246,7 +246,7 @@ static void tegra_channel_surface_setup(
 	int vnc_id = chan->vnc_id[index];
 	unsigned int offset = chan->buffer_offset[index];
 
-	if (chan->embedded.height > 0)
+	if (chan->embedded.height > 0) {
 		vi4_channel_write(chan, vnc_id, ATOMP_EMB_SURFACE_OFFSET0,
 						  chan->vi->emb_buf);
 		vi4_channel_write(chan, vnc_id, ATOMP_EMB_SURFACE_OFFSET0_H,
-- 
2.17.1

